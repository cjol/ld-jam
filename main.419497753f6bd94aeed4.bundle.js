/*! For license information please see main.419497753f6bd94aeed4.bundle.js.LICENSE.txt */
(()=>{var t,e={875:(t,e,s)=>{"use strict";var i=s(260),a=s(492),h=s.n(a);class r extends Phaser.Physics.Matter.Image{constructor(t,e,s){super(t.matter.world,0,0,"fish"+e.type,void 0,{frictionAir:0,mass:.001}),this.x=e.position.x,this.y=e.position.y,this.displayWidth=this.width*e.scale,this.displayHeight=this.height*e.scale,this.velocity=e.direction.scale(e.speed),this.forward=e.direction,this.worth=e.worth,this.weight=e.weight,t.add.existing(this),this.debugLines=[],this.debugLines.push(t.add.line(this.x,this.y,0,0,this.velocity.x,this.velocity.y,16711680)),this.debugLines[0].setOrigin(0,0),this.debugLines.push(t.add.line(this.x,this.y,0,0,this.velocity.x,this.velocity.y,65280)),this.debugLines[1].setOrigin(0,0),this.debugLines.push(t.add.line(this.x,this.y,0,0,this.velocity.x,this.velocity.y,65280)),this.debugLines[2].setOrigin(0,0),this.text=t.add.text(10,10,"Fish 1",{font:"16px Courier",color:"red"}),this.setRotationAngle(e.directionAngle),this.raycaster=s}update(t){const e=t/1e3;let s=new i.Math.Vector2(0,0),a=!1;if(this.isGoingToCollide()){const t=this.obstacleRays(),e=this.steerTowards(t);s.add(e),a=!0}this.velocity.add(s);let h=this.velocity.length(),o=this.velocity.scale(1/h);h=i.Math.Clamp(h,100,1e3),this.velocity=o.clone().scale(h);const n=this.velocity.clone().scale(e);this.x+=n.x,this.y+=n.y,this.setRotationAngle(o.angle()),this.forward=o;for(const t of this.debugLines)t.x=this.x,t.y=this.y;this.debugLines[0].setTo(0,0,100*this.forward.x,100*this.forward.y);const c=new i.Math.Vector2(r.directions[0].x,r.directions[0].y);c.rotate(this.rotation),this.debugLines[1].setTo(0,0,100*c.x,100*c.y);const l=new i.Math.Vector2(r.directions[1].x,r.directions[1].y);l.rotate(this.rotation),this.debugLines[2].setTo(0,0,100*l.x,100*l.y),this.text.setText(["Fish 1",`x: ${this.x}`,`y: ${this.y}`,`velocity: ${this.velocity.x}, ${this.velocity.y}`,`forward: ${this.forward.x}, ${this.forward.y}`,`acceleration: ${s.x}, ${s.y}`,`collided: ${a}`])}setRotationAngle(t){t>0&&this.setFlipX(!0),this.rotation=t}isGoingToCollide(){const t=this.raycaster.createRay(),e=this.x+100*this.forward.x,s=this.y+100*this.forward.y;return t.setPosition(this.x,this.y,e,s),!!t.cast()}obstacleRays(){for(const t of r.directions){const e=new i.Math.Vector2(100*t.x,100*t.y);e.rotate(this.rotation);const s=this.raycaster.createRay();if(s.setPositionAndDirection(this.x,this.y,e.x,e.y),!s.cast())return t}return this.forward}steerTowards(t){const e=t.clone().normalize().scale(r.maxSpeed).subtract(this.velocity);return this.clampMagnitude(e,100)}clampMagnitude(t,e){let s=t.length(),a=t.clone().scale(1/s);return s=i.Math.Clamp(s,0,e),a.scale(s)}}r.directions=[new Phaser.Math.Vector2(Math.sqrt(3)/2,.5),new Phaser.Math.Vector2(Math.sqrt(3)/2,-.5)],r.minSpeed=10,r.maxSpeed=100;class o{constructor(t,e,s){this.fishes=[];for(let i=0;i<e;i++){const e=this.spawnRandomFish(t);this.fishes[i]=new r(t,e,s)}}update(t){this.fishes.forEach((e=>e.update(t)))}spawnRandomFish(t){const e=new i.Math.RandomDataGenerator,s=e.integerInRange(64,t.cameras.main.width-64),a=e.integerInRange(64,t.cameras.main.height-64),h=e.integerInRange(r.minSpeed,r.maxSpeed),o=e.integerInRange(1,100),n=e.integerInRange(0,1e4),c=e.integerInRange(1,3),l=e.rotation(),d=Math.cos(l),g=Math.sin(l),u=e.realInRange(.25,1);return{type:c,worth:n,weight:o,position:new Phaser.Math.Vector2(s,a),directionAngle:l,direction:new Phaser.Math.Vector2(d,g),speed:h,scale:u}}}class n{constructor(t,e,s,i=3){let a;this.segments=[];for(let h=0;h<i;h++){const i=a?a.x:e.x,r=a?a.y:e.y;this.segments[h]=new c(t,i,r,s,a),a=this.segments[h]}t.matter.add.constraint(e,this.segments[0],0,1,{pointA:{x:0,y:20},pointB:{x:-30,y:0}});const h=s;this.hook=new l(t,this.segments[i-1],h,e),e.setCollidesWith(h)}update(){this.segments.forEach((t=>t.update())),this.hook.update()}}class c extends Phaser.Physics.Matter.Image{constructor(t,e,s,i,a){super(t.matter.world,e+80,s,"chain",void 0,{frictionAir:.05,mass:.001,collisionFilter:{group:i}}),this.scene=t,this.displayHeight=20,this.displayWidth=80,t.add.existing(this),a&&t.matter.add.constraint(a,this,0,1,{pointA:{x:30,y:0},pointB:{x:-30,y:0}})}}class l extends Phaser.Physics.Matter.Image{constructor(t,e,s,i){super(t.matter.world,e.x+40,e.y,"mechanical-hook",void 0,{frictionAir:.05,mass:.1,collisionFilter:{group:s}}),this.prev=e,this.scene=t,t.add.existing(this),this.sub=i,this.displayHeight=40,this.displayWidth=40,t.matter.add.constraint(e,this,0,1,{pointA:{x:40,y:0},pointB:{x:0,y:0}}),this.setupKeys()}setupKeys(){this.keys=this.scene.input.keyboard.addKeys({up:"UP",down:"DOWN",left:"LEFT",right:"RIGHT"},!0,!0)}update(){this.angle=this.prev.angle-90,this.keys.left.isDown?this.setVelocityX(-5):this.keys.right.isDown&&this.setVelocityX(5),this.keys.up.isDown?this.setVelocityY(-5):this.keys.down.isDown&&this.setVelocityY(5)}catchFish(t){this.sub.cargo.fishWeight+=t.weight,this.sub.cargo.fishValue+=t.worth}collectOre(){}collectResearch(){}}class d{constructor(t,e){this.scene=t,this.submarine=e,this.totalWealth=0,this.currentWealth=0,this.maxDepthReached=0,this.currentDepth=0,this.upgrades={capacity:{current:10,totalUpgrades:[10,20,30,50,75,100],upgradesBrought:0},depthLimit:{current:250,totalUpgrades:[250,500,1e3,2e3,3e3,1e4],upgradesBrought:0},armour:{current:2,totalUpgrades:[2,3,4,5,6],upgradesBrought:0},chain:{current:2,totalUpgrades:[2,3,4],upgradesBrought:0},tank:{current:45,totalUpgrades:[45,90,135,180,225,270,305],upgradesBrought:0},shipSpeed:{current:5,totalUpgrades:[5,6,7],upgradesBrought:0},clawSpeed:{current:5,totalUpgrades:[5,6,7],upgradesBrought:0},clawSize:{current:.25,totalUpgrades:[.25,.3,.35,.4],upgradesBrought:0},location:{current:0,totalUpgrades:[0,1,2],upgradesBrought:0},collectable:{current:0,totalUpgrades:[0,1,2],upgradesBrought:0}},this.updateSub(),this.scene.matter.world.on("collisionstart",this.watchCollisions.bind(this))}updateSub(){this.submarine.maxOxygen=this.upgrades.tank.totalUpgrades[this.upgrades.tank.upgradesBrought],this.submarine.oxygen=this.submarine.maxOxygen,this.submarine.maxCapacity=this.upgrades.capacity[this.upgrades.capacity.upgradesBrought]}purchaseUpgrade(t){var e=this.upgrades[t];e.upgradesBrought<e.totalUpgrades.length&&(e.upgradesBrought+=1)}sellFish(){console.log("I'm selling all my fish!"),console.log("My new current worth is... "+this.currentWealth);var t=this.submarine.cargo.fishValue;this.totalWealth+=t,this.currentWealth+=t,this.submarine.cargo.fishValue=0,this.submarine.cargo.fishWeight=0}sellOre(){console.log("I'm selling all my ore!");var t=this.submarine.cargo.oreValue;this.totalWealth+=t,this.currentWealth+=t,this.submarine.cargo.oreValue=0,this.submarine.cargo.oreWeight=0}sellResearch(){console.log("I'm selling all my research!");var t=this.submarine.cargo.researchValue;this.totalWealth+=t,this.currentWealth+=t,this.submarine.cargo.researchValue=0,this.submarine.cargo.researchWeight=0}watchCollisions(t){t.pairs.map(g).filter((t=>null!==t)).forEach((t=>{const e=t.hook,s=t.item;console.log("Caught something!",s),s instanceof r&&e.catchFish(s)}))}}function g(t){return t.bodyA.gameObject instanceof l?{hook:t.bodyA.gameObject,item:t.bodyB.gameObject}:t.bodyB.gameObject instanceof l?{hook:t.bodyB.gameObject,item:t.bodyA.gameObject}:null}class u extends Phaser.GameObjects.Sprite{constructor(t,e,s,i,a){super(t,s,i,e),t.add.existing(this),this.buttonKey=e,this.gameManager=a,this.setInteractive(),this.setScale(.25),this.setAlpha(.25);let h=this;this.on("pointerdown",(function(){h.buttonWasClicked()})),this.on("pointerover",(function(){h.buttonMouseover()})),this.on("pointerout",(function(){h.buttonMouseout()}))}buttonWasClicked(){switch(this.buttonKey){case"sell-fish-button":this.gameManager.sellFish();break;case"sell-ore-button":this.gameManager.sellOre();break;case"sell-research-button":this.gameManager.sellResearch()}}buttonMouseover(){this.setAlpha(1)}buttonMouseout(){this.setAlpha(.25)}}class p{constructor(t,e){this.scene=t,this.gameManager=e,this.sellFishButton=new u(this.scene,"sell-fish-button",100,100,this.gameManager),this.sellOreButton=new u(this.scene,"sell-ore-button",100,200,this.gameManager),this.sellResearchButton=new u(this.scene,"sell-research-button",100,300,this.gameManager)}}const y={width:80,height:16,lowColor:16711680,color:35071,lowThreshold:.3};class m extends Phaser.GameObjects.Graphics{constructor(t,e,s,i,a=i,h=y){super(t),this.x=e,this.y=s,this.maxValue=i,this.value=a,t.add.existing(this),this.config=h}update(t,e,s,i){i&&(this.maxValue=i),this.value=s,this.x=t,this.y=e,this.clear(),this.fillStyle(0),this.fillRect(-this.config.width/2,0,this.config.width,this.config.height),this.fillStyle(16777215),this.fillRect(-this.config.width/2+2,2,this.config.width-4,this.config.height-4);const a=this.value/this.maxValue;a<this.config.lowThreshold?this.fillStyle(this.config.lowColor):this.fillStyle(this.config.color);var h=Math.floor(a*(this.config.width-4));this.fillRect(-this.config.width/2+2,2,h,this.config.height-4)}}class f extends Phaser.Physics.Matter.Image{constructor(t,e,s){super(t.matter.world,e,s,"submarine",void 0,{frictionAir:.05,mass:500,restitution:.6}),t.add.existing(this),this.setupKeys();const i=t.matter.world.nextGroup(!0);this.setCollisionGroup(i),this.hook=new n(t,this,i),this.oxygenBar=new m(t,50,50,100,100),this.setScale(.025),this.cargo={fishWeight:0,fishValue:0,oreWeight:0,oreValue:0,researchWeight:0,researchValue:0},this.maxOxygen=0,this.oxygen=0,this.maxCapacity=0}setupKeys(){this.keys=this.scene.input.keyboard.addKeys({up:"W",down:"S",left:"A",right:"D"},!0,!0)}update(){this.hook.update(),this.updateKeys(),this.updateOxygen(),this.setRotation(0)}updateKeys(){this.keys.left.isDown?(this.setVelocityX(-5),this.setFlip(!0,!1)):this.keys.right.isDown&&(this.setVelocityX(5),this.setFlip(!1,!1)),this.keys.up.isDown?this.setVelocityY(-5):this.keys.down.isDown&&this.setVelocityY(5),this.y<200&&(this.y=200)}updateOxygen(){this.y>220?this.oxygen-=.05:this.oxygen+=1,this.oxygen=Math.max(0,Math.min(this.oxygen,this.maxOxygen)),this.oxygenBar.update(this.x,this.y+-80,this.oxygen,this.maxOxygen)}}class w extends Phaser.GameObjects.GameObject{constructor(t,e,s){super(t,"background"),this.BACKGROUND_COLOUR=2378622,t.add.existing(this),this.graphics=t.add.graphics(),this.width=t.cameras.main.width,this.height=e;const a=i.Math.CeilTo(this.width/64),h=i.Math.CeilTo((64*a-this.width)/2),r=[1];for(let t=0;t<a-2;t++)r.push(0);r.push(1);const o=[];for(let t=0;t<a;t++)o.push(0);const n=[];for(let t=0;t<a;t++)n.push(2);const c=[o,o,n],l=i.Math.FloorTo(this.height/64)+1;for(let t=0;t<l;t++)c.push(r.slice());this.tilemap=t.make.tilemap({data:c,tileWidth:64,tileHeight:64,insertNull:!1}),this.tilemap.addTilesetImage("background-tiles",void 0,256,256);const d=this.tilemap.createLayer(0,"background-tiles",-h,0);d.setCollisionByExclusion([0,2]),t.matter.world.convertTilemapLayer(d);for(let t=0;t<l;t++)this.tilemap.getTileAt(0,t).setFlip(!0,!1);s.registerBodies(d,a,l)}draw(){this.graphics.clear(),this.graphics.fillGradientStyle(this.BACKGROUND_COLOUR,this.BACKGROUND_COLOUR,1,1),this.graphics.fillRect(0,0,this.width,this.height)}}class x{constructor(t,e){this.physics=t,this.tileBodies=e}setPosition(t,e,s,i){this.x1=t,this.y1=e,this.x2=s,this.y2=i}setPositionAndDirection(t,e,s,i){this.x1=t,this.y1=e,this.x2=t+s,this.y2=e+i}cast(){return this.physics.intersectRay(this.x1,this.y1,this.x2,this.y2,1,this.tileBodies).length>0}}class b{constructor(t){this.tileBodies=[],this.physics=t}registerBodies(t,e,s){const i=t.getTilesWithin(0,0,e,s);for(const t of i)t&&t.physics&&t.physics.matterBody&&this.tileBodies.push(t.physics.matterBody)}createRay(){return new x(this.physics,this.tileBodies)}}class v extends Phaser.Scene{constructor(){super({key:"MainScene"})}create(){this.width=this.cameras.main.width,this.height=this.cameras.main.height;const t=new b(this.matter),e=1e4;this.matter.world.setBounds(0,0,this.width,e),this.cameras.main.setBounds(0,0,this.width,e),this.background=new w(this,e,t),this.submarine=new f(this,this.width/2,200),this.fishGroup=new o(this,1,t),this.gameManager=new d(this,this.submarine),this.UIGameObject=new p(this,this.gameManager),this.cameras.main.startFollow(this.submarine)}update(t,e){this.background.draw(),this.submarine.update(),this.fishGroup.update(e)}}class k extends Phaser.Scene{constructor(){super({key:"PreloadScene"})}preload(){this.load.image("submarine","assets/img/submarine.png"),this.load.image("mechanical-hook","assets/img/claw.png"),this.load.image("chain","assets/img/chain.png"),this.load.image("fish1","assets/img/fish_type1.png"),this.load.image("fish2","assets/img/fish_type2.png"),this.load.image("fish3","assets/img/fish_type3.png"),this.load.image("background-tiles","assets/img/tiles/wall.png"),this.load.image("waterline-tiles","assets/img/tiles/water-top.png"),this.load.image("sell-fish-button","assets/img/ui/sell_fish_button.png")}create(){this.scene.start("MainScene")}}class O extends Phaser.GameObjects.Text{constructor(t){super(t,10,10,"",{color:"black",fontSize:"28px"}),t.add.existing(this),this.setOrigin(0)}update(){this.setText(`fps: ${Math.floor(this.scene.game.loop.actualFps)}`)}}class M extends Phaser.Scene{constructor(){super({key:"UIScene"})}create(){this.fpsText=new O(this)}update(t,e){this.fpsText.update()}}const B={type:Phaser.AUTO,backgroundColor:"#ffffff",scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:window.innerWidth,height:window.innerHeight},scene:[k,v,M],physics:{default:"matter",matter:{debug:!1,gravity:{y:0}}},plugins:{scene:[{key:"PhaserRaycaster",plugin:h(),mapping:"raycasterPlugin"}]}};window.addEventListener("load",(()=>{new Phaser.Game(B)}))},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},s={};function i(t){var a=s[t];if(void 0!==a)return a.exports;var h=s[t]={exports:{}};return e[t].call(h.exports,h,h.exports,i),h.exports}i.m=e,t=[],i.O=(e,s,a,h)=>{if(!s){var r=1/0;for(c=0;c<t.length;c++){for(var[s,a,h]=t[c],o=!0,n=0;n<s.length;n++)(!1&h||r>=h)&&Object.keys(i.O).every((t=>i.O[t](s[n])))?s.splice(n--,1):(o=!1,h<r&&(r=h));o&&(t.splice(c--,1),e=a())}return e}h=h||0;for(var c=t.length;c>0&&t[c-1][2]>h;c--)t[c]=t[c-1];t[c]=[s,a,h]},i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={179:0};i.O.j=e=>0===t[e];var e=(e,s)=>{var a,h,[r,o,n]=s,c=0;for(a in o)i.o(o,a)&&(i.m[a]=o[a]);if(n)var l=n(i);for(e&&e(s);c<r.length;c++)h=r[c],i.o(t,h)&&t[h]&&t[h][0](),t[r[c]]=0;return i.O(l)},s=self.webpackChunkphaser_project_template=self.webpackChunkphaser_project_template||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})(),i.O(void 0,[216],(()=>i(875)));var a=i.O(void 0,[216],(()=>i(204)));a=i.O(a)})();